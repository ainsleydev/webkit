# Code generated by webkit; DO NOT EDIT.
name: Deploy Container App

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: 'Application to deploy'
        required: true
        type: choice
        options:
          - web
      image_tag:
        description: 'Image tag to deploy (e.g., sha-abc123 or latest)'
        required: false
        type: string
        default: 'latest'
  workflow_call:
    inputs:
      app_name:
        description: 'Application to deploy'
        required: true
        type: string
      image_tag:
        description: 'Image tag to deploy (e.g., sha-abc123 or latest)'
        required: false
        type: string
        default: 'latest'
    secrets:
      REPO_DO_ACCESS_TOKEN:
        required: false
      ORG_DO_ACCESS_TOKEN:
        required: false

permissions:
  contents: read
  packages: read

# Prevent concurrent deployments.
concurrency:
  group: deploy-container-${{ github.event.inputs.app_name }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # Deploy Web to DigitalOcean App Platform
  deploy-web:
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.app_name }} == 'web'
    environment:
      name: production-web
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v5

      - name: Deploy Web to DigitalOcean App Platform
        uses: digitalocean/app_action/deploy@v2
        env:
          IMAGE_TAG_SVELTE_KIT: ${{ github.event.inputs.image_tag }}
        with:
          token: ${{ secrets.REPO_DO_ACCESS_TOKEN || secrets.ORG_DO_ACCESS_TOKEN }}
          app_name: '${{ github.event.repository.name }}-web'

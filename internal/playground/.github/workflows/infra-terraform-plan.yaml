# Code generated by webkit; DO NOT EDIT.
name: Terraform Plan

on:
  pull_request:
    branches: [main, staging]
    paths:
      - 'app.json'
      - '.github/workflows/terraform-*.yml'

env:
  WEBKIT_VERSION: 'v1.0.0'  # This will be generated by webkit CLI
  WEBKIT_REPO: 'https://github.com/ainsleydev/webkit'
  PROJECT_NAME: 'my-website'  # This will be generated from app.json
  TF_VERSION: '1.13.0'

jobs:
  plan:
    name: Plan Infrastructure Changes
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    with:
      project_name: my-website

      resources: '[{"name":"db","type":"postgres","provider":"digitalocean","config":{"engine_version":"17","region":"nyc3","size":"db-s-1vcpu-1gb"},"outputs":["connection_url","host","port","database"],"backup":{"enabled":true}},{"name":"store","type":"s3","provider":"digitalocean","config":{"acl":"public-read","region":"ams3"},"outputs":["bucket_name","endpoint","region"],"backup":{"enabled":true}}]'
      apps: '[{"name":"cms","title":"CMS","type":"payload","description":"Payload CMS for managing content.","path":"cms","build":{"dockerfile":"Dockerfile"},"infra":{"provider":"digitalocean","type":"vm","config":{"domain":"cms.my-website.com","region":"nyc3","size":"s-2vcpu-4gb","ssh_keys":["your-ssh-key-id"]}},"env":{"dev":{"DATABASE_URL":{"source":"resource","value":"db.connection_url"},"PAYLOAD_SECRET":{"source":"sops","path":"secrets/cms.yaml:PAYLOAD_SECRET"}},"staging":{"DATABASE_URL":{"source":"resource","value":"db.connection_url"}},"production":{"DATABASE_URL":{"source":"resource","value":"db.connection_url"},"PAYLOAD_SECRET":{"source":"sops","path":"secrets/production.yaml:PAYLOAD_SECRET"}}},"commands":{"format":{"command":"pnpm format"},"lint":{"command":"pnpm lint"},"test":{"command":"pnpm test"}}},{"name":"web","title":"Web","type":"svelte-kit","path":"web","build":{"dockerfile":"Dockerfile"},"infra":{"provider":"digitalocean","type":"app","config":{"domain":"www.my-website.com","env_from_shared":true,"instance_count":2,"region":"fra1"}},"env":{"dev":{"PUBLIC_API_URL":{"source":"value","value":"http://localhost:3000"}},"production":{"ASSETS_BUCKET":{"source":"resource","value":"store.bucket_name"},"PUBLIC_API_URL":{"source":"value","value":"https://api.my-website.com"}}},"commands":{"format":{"command":"pnpm format"},"lint":{"command":"pnpm lint"},"test":{"command":"pnpm test"}}}]'


